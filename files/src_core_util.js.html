<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>src\core\util.js - smartjs</title>
  
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="stylesheet" href="../assets/css/custom.css">
    <link rel="stylesheet" href="../assets/vendor/bootstrap/css/bootstrap.css">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
</head>
<body class="yui3-skin-sam">
<div class="navbar navbar-fixed-top">
    <div class="navbar-inner">
        <h1 class="brand" style="padding: 10px 16px 10px; height: 20px; line-height: 20px; margin-left: 0;">
        
	    <img alt="smartjs" src="../assets/css/logo.png" style="max-height: 65%;" title="smartjs">
        
            smartjs
        </h1>
	<div class="nav">
            <li class="divider-vertical"></li>
            <li>
                <p class="navbar-text">
                    API Docs for Version: <b>0.4.0</b>
                </p>
            </li>
        </div>
        <form class="navbar-form pull-right" style="line-height: 40px; height: 40px;">
            <input style="margin-top: 0;" type="text" class="search-query" placeholder="Search for classes/modules..." data-obj='["classes/attachTrigger", "classes/baseDataManager", "classes/baseDataService", "classes/dataManager", "classes/dataServices", "classes/EventArg", "classes/EventArg(flowController)", "classes/EventArg(trigger)", "classes/factory", "classes/FilterBuilder", "classes/flowController", "classes/klass", "classes/klassBase", "classes/Operations", "classes/priorityList", "classes/promiseEvent", "classes/util", "modules/AOP", "modules/DataManager", "modules/DataManager-Table", "modules/FilterBuilder", "modules/OOP", "modules/Util"]'>
        </form>
    </div>
</div>
<div class="container">
    <div class="row">
        <div class="span3">
	    <div>
    <h3>APIs</h3>
    <div id="sidebar">
        <ul id="main-nav" class="nav nav-tabs" style="margin-bottom:0;">
            <li class="active"><a href="#modules" data-toggle="tab">Modules</a></li>
            <li><a href="#classes" data-toggle="tab">Classes</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" placeholder="Type to filter APIs">
        </div>

        <div class="tab-content" style="border: 1px solid #DDD; border-top:0;">
            <div class="tab-pane active" id="modules">
                <ul id="api-modules" class="nav nav-list">
                    
                        <li><a href="../modules/AOP.html">AOP</a></li>
                    
                        <li><a href="../modules/DataManager.html">DataManager</a></li>
                    
                        <li><a href="../modules/DataManager-Table.html">DataManager-Table</a></li>
                    
                        <li><a href="../modules/FilterBuilder.html">FilterBuilder</a></li>
                    
                        <li><a href="../modules/OOP.html">OOP</a></li>
                    
                        <li><a href="../modules/Util.html">Util</a></li>
                    
                </ul>
            </div>
            <div class="tab-pane" id="classes">
                <ul id="api-classes" class="nav nav-list">
                    
                        <li><a href="../classes/attachTrigger.html">attachTrigger</a></li>
                    
                        <li><a href="../classes/baseDataManager.html">baseDataManager</a></li>
                    
                        <li><a href="../classes/baseDataService.html">baseDataService</a></li>
                    
                        <li><a href="../classes/dataManager.html">dataManager</a></li>
                    
                        <li><a href="../classes/dataServices.html">dataServices</a></li>
                    
                        <li><a href="../classes/EventArg.html">EventArg</a></li>
                    
                        <li><a href="../classes/EventArg(flowController).html">EventArg(flowController)</a></li>
                    
                        <li><a href="../classes/EventArg(trigger).html">EventArg(trigger)</a></li>
                    
                        <li><a href="../classes/factory.html">factory</a></li>
                    
                        <li><a href="../classes/FilterBuilder.html">FilterBuilder</a></li>
                    
                        <li><a href="../classes/flowController.html">flowController</a></li>
                    
                        <li><a href="../classes/klass.html">klass</a></li>
                    
                        <li><a href="../classes/klassBase.html">klassBase</a></li>
                    
                        <li><a href="../classes/Operations.html">Operations</a></li>
                    
                        <li><a href="../classes/priorityList.html">priorityList</a></li>
                    
                        <li><a href="../classes/promiseEvent.html">promiseEvent</a></li>
                    
                        <li><a href="../classes/util.html">util</a></li>
                    
                </ul>
            </div>

            
        </div>
    </div>
</div>

        </div>
        <div class="span9">
            <!--     <form id="options-form" class="form-inline pull-right">
        Show:
        <label for="api-show-inherited" class="checkbox">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected" class="checkbox">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private" class="checkbox">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated" class="checkbox">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </form>

 -->
            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <div class="page-header">
    <h1>src\core\util.js <small>File</small></h1>
</div>

<div class="file">
    <pre class="prettyprint linenums" id='src_code'>

/**
	工具包模块

	Feartures : 
		1. 基础公共方法
		2. 基础公共对象

	Update Note：
		+ 2014.8.06 加入priorityList
		+ 2014.5 ：Created
		
	@module Util
*/
stDefine(&#x27;util&#x27;, function(st) {
	&quot;use strict&quot;

	/**
        util常用公共方法
        @class util
    */
    var util = {
		sliceArgs: sliceArgs,
		copy: copy,
		injectFn: injectFn,
		mergeFn: mergeFn,
		mergeObj: mergeObj,
		getObj: getObj,
		setObj: setObj,
		priorityList: priorityList
	};

	/**
        将argument转换成array
        @method sliceArgs
        @param args {function} argument对象
        @param [start = 0] {number} 开始位置
        @return [array] 返回转换的数组
        @example
        	 function test() {
        	 	//从第二个参数开发返回
                return st.sliceArgs(arguments, 1);
            }
            expect(test(1, 2, 3, 4).join(&#x27;,&#x27;)).toBe(&#x27;2,3,4&#x27;);
    */
	function sliceArgs(args, start) {
		return Array.prototype.slice.call(args, start || 0);
	}

	function isPlainObject(obj) {
		return $.isPlainObject(obj);
	}

	/**
        复制数据方法,支持对象字面量和数组的复制
        @method copy
        @todo：st内部对象的复制功能
        @param deep {boolean} 是否深度复制
        @param obj {object | array} 注入的方法名
        @return 返回复制之后的对象
    */
	function copy(deep, obj) {
		if (typeof deep !== &#x27;boolean&#x27;) {
			obj = deep;
			deep = false;
		}
		return $.extend(deep, {}, obj)
	}

    /**
        在目标对象方法中注入方法，返回结果
        @method injectFn
        @param target {object} 注入的目标对象
        @param name {string} 注入的方法名
        @param fn {function} 注入方法
        @param [before] {boolean} 是否前置注入，默认后置
        @param [stopOnFalse] {boolean} 是否开启返回值为false停止后续执行
        @example 
        	var result = [],
                target = {
                    test: function(arr) {
                        arr.push(&quot;test&quot;);
                    }
                };

                
            function fn(arr) {
                arr.push(&quot;inject&quot;);
            }
            
            //向target注入方法fn
            st.injectFn(target, &quot;test&quot;, fn);

            target.test(result);

            //结果执行注入函数fn
            expect(result + &#x27;&#x27;).toBe(&#x27;test,inject&#x27;);
    */
	function injectFn(target, name, fn, before, stopOnFalse) {
		if (!target &amp;&amp; !name)
			return;

		var targetFn = target[name];
		target[name] = before ? mergeFn(fn, targetFn, stopOnFalse) : mergeFn(targetFn, fn, stopOnFalse);
	}

	/**
        合并方法，返回结果
        @method mergeFn
        @param fn {function} 目标方法
        @param mergeFn {function} 合并方法，合并的方法始终在后执行
        @param [stopOnFalse] {boolean} 是否开启返回值为false停止后续执行
        @return [function] 返回合并之后的新方法
        @example
        	var result = [],
                fn1, fn2, fn3;

            //合并方法1
            fn1 = function(arr) {
                arr.push(&quot;fn1&quot;);
                return false;
            }
            //合并方法2
            fn2 = function(arr) {
                arr.push(&quot;fn2&quot;);
            }

            //将fn1和fn2合并成一个新方法fn3，并开启stopOnFalse
            fn3 = st.mergeFn(fn1, fn2, true);

            fn3(result);
            //最终因为fn1执行返回false，fn2不执行，
            expect(result + &#x27;&#x27;).toBe(&#x27;fn1&#x27;);
    */
	function mergeFn(fn, mergeFn, stopOnFalse) {
		if (!mergeFn)
			return fn;

		if (!fn)
			return mergeFn;

		return function() {
			var self = this,
				result, args = arguments;

			result = fn.apply(self, args);
			if (stopOnFalse &amp;&amp; result === false)
				return result;


			return mergeFn.apply(self, args);;
		}
	}

	function _mergeObj(deep, obj, defObj, group, fnCheck) {
		var prop, valueType, propType;
		$.each(defObj, function(name, value) {
			//判断是否拷贝
			if ((fnCheck &amp;&amp; fnCheck(group + name) === false))
				return;

			var ng = group + name + &#x27;.&#x27;;
			if (value != null) {
				if ((prop = obj[name]) == null) {
					if (deep) {
						if ($.isArray(value))
							value = [].concat(value);
						else if (isPlainObject(value))
							value = _mergeObj(deep, {}, value, ng, fnCheck)
					}
					obj[name] = value;

				} else if (deep &amp;&amp; isPlainObject(prop) &amp;&amp; isPlainObject(value)) {
					_mergeObj(deep, prop, value, ng, fnCheck);
				}
			}
		});
		return obj;
	}

	/**
        合并默认数据方法,将obj中不空的内容从defObj中复制
        @method mergeObj
        @param [deep] {Number} 是否深度合并
        @param obj {function} 合并对象
        @param defObj {function} 默认对象
        @param [exclude] {array|function} 排除合并的设置
        @return [function] 返回合并之后的对象；如obj不为空时返回obj，否则返回新对象
        @example
        	var person = {
	            name: &quot;piter&quot;,
	            age: 10,
	            child: [{
	                name: &#x27;lily&#x27;
	            }]
	        };

	        var obj = {
                name: &#x27;a&#x27;
            };

            //根据person的数据进行合并
            st.mergeObj(obj, person);

            //child被复制
            expect(obj.child).toBeDefined();

            //age被复制
            expect(obj.age).toBe(10);

            //name不为null，未被复制
            expect(obj.name).toBe(&#x27;a&#x27;);
    */
	function mergeObj(deep, obj, defObj, exclude) {
		var fnCheck;
		if (typeof deep !== &#x27;boolean&#x27;) {
			exclude = defObj;
			defObj = obj;
			obj = deep;
			deep = false;
		}

		if (defObj == null || $.isEmptyObject(defObj))
			return obj;

		//设置例外判断方法
		if (exclude) {
			if (typeof exclude === &#x27;function&#x27;)
				fnCheck = exclude;
			else if (exclude.length) {
				fnCheck = function(name) {
					return exclude.indexOf(name) === -1;
				}
			}
		}

		return _mergeObj(deep, obj || {}, defObj, &#x27;&#x27;, fnCheck);
	}


	function handleObj(target, ns, root, fn) {
		var result, i, name, len;
		if (!target)
			return null;

		ns = ns.split(&#x27;.&#x27;);

		for (i = root ? 1 : 0, len = ns.length; i &lt; len; i++) {
			if (name = ns[i]) {
				result = fn(i, name, len);
				if (result !== undefined)
					return result;
			}
		}
		return result;
	}

	/**
        获取对象的属性或方法，支持命名空间方式获取
        @method getObj
        @param target {object} 目标对象
        @param ns {string} 属性名称或者相对于target的路径，使用&quot;.&quot;进行分割
        @param [root] {boolean} 是否从根开始，默认从target子开始；从根开始则忽略ns的第一级
        @return [object] 返回获取的属性或者方法
        @example
        	//等同于user.project.name
        	st.getObj(user,&#x27;project.name&#x27;);
			
			//等同于user.name
        	st.getObj(user,&#x27;u.name&#x27;,true);

    */
	function getObj(target, ns, root) {
		var obj = target,
			result;
		result = handleObj(target, ns, root, function(i, name, len) {
			obj = obj[name];
			if (!obj)
				return null;
		})
		return result === null ? result : obj;
	}

	/**
        设置对象的属性或方法，支持命名空间方式设置
        @method setObj
        @param target {object} 目标对象
        @param ns {string} 属性名称或者相对于target的路径，使用&quot;.&quot;进行分割
        @param value {object} 设置的值
        @param [mode] {string} 值设置的方式,目标对象和值都为object类型有效，默认为替换；&quot;merge&quot; : 合并默认值；&quot;extend&quot; : extend方式合并值；
        @param [root] {boolean} 是否从根开始，默认从target子开始；从根开始则忽略ns的第一级
        @return [object] 返回获取的属性或者方法
        @example

        	//等同于 user.name = &#x27;roy&#x27;
        	st.setObj(user,&#x27;name&#x27;,&#x27;roy&#x27;);

			//等同于 user.project.name = &#x27;smartjs&#x27;;
        	st.setObj(user,&#x27;project.name&#x27;,&#x27;smartjs&#x27;);

        	//等同于 st.mergeObj(user.project,{name:&#x27;smartjs&#x27;});
        	st.setObj(user,&#x27;project&#x27;,{name:&#x27;smartjs&#x27;},&quot;merge&quot;);

    */
	function setObj(target, ns, value, mode, root) {
		var obj = target,
			_tmpl, _prop,
			result;

		if (typeof(mode) === &#x27;boolean&#x27;) {
			_tmpl = mode;
			root = mode;
			mode = _tmpl;
		}

		result = handleObj(target, ns, root, function(i, name, len) {
			_prop = obj[name];
			if (i === len - 1) {
				if (mode &amp;&amp; isPlainObject(_prop))
					mode === &#x27;merge&#x27; ? mergeObj(true, _prop, value) : $.extend(true, _prop, value);
				else
					obj[name] = value;
			} else {
				obj = isPlainObject(_prop) ? _prop : (obj[name] = {});
			}
		})
		return result === null ? result : obj;
	}

	/**
		权重列表,根据权重的由大到小进入插入。
		具有两种item模式：
			1. 默认，正常item，手动设置priority
			2. self，读取item的priority属性
		@class priorityList
		@constructor
		@param [mode] {string} item模式 
		@param [defaultPriority=0] {number} item模式 
		@example
			var list = st.priorityList();
	*/
	function priorityList(mode, defaultPriority) {
		var _maxPriority = 0,
			_minPriority = 0,
			isSelf = mode === &#x27;self&#x27;,
			_list = [],
			_priority = defaultPriority || 0;

		function getItem(item) {
			return isSelf ? item : item.target;
		}

		 /**
            执行回调
            @method add
            @param item {Object} 添加对象
            @param [priority] {number} 权重
            @chainable
            @example 
	            //添加项
	            list.add(1).add(0);

	            //根据priority添加项
	            list.add(10, 10).add(5, 5).add(-1, -1);

	            //最终存储为[10,5,1,0,-1]
        */
		function add(item, priority) {
			var len = _list.length;
			if (isSelf)
				priority = item.priority;

			if (priority == null)
				priority = _priority;

			if (!isSelf) {
				item = {
					target: item,
					priority: priority
				}
			}

			//优先级判断
			if (priority &gt; _maxPriority) {
				_maxPriority = priority;
				_list.unshift(item);
				len || (_minPriority = priority);
			} else {
				if (priority &lt;= _minPriority) {
					_list.push(item);
					_minPriority = priority;
					len || (_maxPriority = priority);
				} else {
					for (var i = 1; i &lt; len; i++) {
						if (_list[i].priority &lt; priority) {
							break;
						}
					}

					if (i &gt; len) {
						_minPriority = priority;
					}
					_list.splice(i, 0, item);
				}
			}
			return this;
		}

		/**
            执行回调
            @method remove
            @param filter {function} 过滤函数，返回值：
             1. {boolean}：是否匹配；
             2. &#x27;break&#x27; : 结束匹配；
             3. &#x27;done&#x27; : 完成匹配
            @chainable
            @example 
	           	//删除 item为1的项
	            list.remove(function(item){
	                if(item === 1)
	                	//结束匹配
	                    return &quot;done&quot;;
	            })
        */
		function remove(filter) {
			var type = typeof filter;
			if (type === &#x27;function&#x27;) {
				var i = 0,
					result, item;
				for (; item = _list[i]; i++) {
					result = filter(getItem(item), i, _list);
					//break立即退出
					if (result === &#x27;break&#x27;)
						break;

					if (result) {
						_list.splice(i, 1);
						i--;
						//完成退出
						if (result === &#x27;done&#x27;)
							break;
					}
				}
			} else if (type === &#x27;number&#x27;)
				_list.splice(i, 1);

			return this;
		}

		/**
           	循环列表方法，默认根据priority大到小
            @method each
            @param [desc] {boolean} 是否降序，即根据priority由小到大
            @param handler {function} 循环处理函数
            @chainable
			@example 
				 //按优先级大到小循环
	            list.each(function(item) {
	                result.push(item);
	            })
	            expect(result + &#x27;&#x27;).toBe(&#x27;10,5,1,0,-1&#x27;);

				//按优先级小到大循环
	            list.each(true,function(item) {
	                result.push(item);
	            })
	            expect(result + &#x27;&#x27;).toBe(&#x27;-1,0,1,5,10&#x27;);
        */
		function each(desc, handler) {
			var i, step, item;
			if (_list.length === 0)
				return this;

			if (typeof desc === &#x27;function&#x27;) {
				handler = desc;
				desc = false;
			}

			if (desc) {
				i = _list.length - 1;
				step = -1;
			} else {
				i = 0;
				step = 1;
			}
			for (; item = _list[i]; i += step) {
				if (handler(getItem(item), i, _list) === false) {
					break;
				}
			}
			return this;
		}

		return {
			add: add,
			remove: remove,
			each: each,
			/**
				根据序号获取item
				@method at
				@param index {number} 序号
				@return {object} 返回item
			*/
			at: function(index) {
				var item = _list[index];
				return item &amp;&amp; getItem(item);
			},
			/**
				清除所有项
				@method clear
				@chainable
			*/
			clear: function() {
				_list = [];
				_maxPriority = _minPriority = 0;
				return this;
			},
			/**
				获取列表长度
				@method len
				@return {number} 列表长度
			*/
			len: function() {
				return _list.length;
			}
		};

	}

	return util;
})
    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/jquery/jquery-1.8.2.min.js"></script>
<script src="../assets/vendor/bootstrap/js/bootstrap.js"></script>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script src="../assets/js/yuidoc-bootstrap.js"></script>
<script>prettyPrint();</script>
</body>
</html>
